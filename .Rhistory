x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
liver_lver
ggplot(a_liver, aes(
x = PC1,
y = PC2,
color = treatment,
shape = diet)) +
geom_point(size = 4) +
geom_text_repel(aes(label = sample_name),  # add sample_name as text
size = 4,
box.padding = 0.3,
point.padding = 0.3,
segment.alpha = 0.5) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
scale_color_manual(values = cols_treatment) +
theme_pubr(border = TRUE) +
#coord_fixed(ratio = 1) +
theme(
axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")
) +
labs(
x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
# Extract just the number from sample_name
a_liver$sample_number <- sub(".*?([0-9]+)$", "\\1", a_liver$sample_name)
# Check that it worked
head(a_liver[, c("sample_name", "sample_number")])
library(ggrepel)
liver_lver <- ggplot(a_liver, aes(
x = PC1,
y = PC2,
color = treatment,
shape = diet)) +
geom_point(size = 4) +
geom_text_repel(aes(label = sample_number),  # use just the number
size = 4,
box.padding = 0.3,
point.padding = 0.3,
segment.alpha = 0.5) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
scale_color_manual(values = cols_treatment) +
theme_pubr(border = TRUE) +
coord_fixed(ratio = 1) +
theme(
axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")
) +
labs(
x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
liver_lver
liver_lver <- ggplot(a_liver, aes(
x = PC1,
y = PC2,
color = treatment,
shape = diet)) +
geom_point(size = 4) +
geom_text_repel(aes(label = sample_number),  # use just the number
size = 4,
box.padding = 0.3,
point.padding = 0.3,
segment.alpha = 0.5) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
scale_color_manual(values = cols_treatment) +
theme_pubr(border = TRUE) +
#coord_fixed(ratio = 1) +
theme(
axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")
) +
labs(
x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
liver_lver
liver_lver <- ggplot(a_liver, aes(
x = PC1,
y = PC2,
color = treatment,
shape = diet)) +
geom_point(size = 4) +
geom_text_repel(aes(label = sample_number),  # use just the number
size = 4,
box.padding = 0.3,
point.padding = 0.3,
segment.alpha = 0.5) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
scale_color_manual(values = cols_treatment) +
theme_pubr(border = TRUE) +
coord_fixed(ratio = 1) +
theme(
axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")
) +
labs(
x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
liver_lver
library(plotly)
# Convert your ggplot to plotly
liver_lver_plotly <- ggplotly(liver_lver, tooltip = c("sample_number", "treatment", "diet"))
# Display interactive plot
liver_lver_plotly
liver_lver <- ggplot(a_liver, aes(
x = PC1,
y = PC2,
color = treatment,
shape = diet)) +
geom_point(size = 4) +
geom_text_repel(aes(label = sample_number),  # use just the number
size = 4,
box.padding = 0.3,
point.padding = 0.3,
segment.alpha = 0.5) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
scale_color_manual(values = cols_treatment) +
theme_pubr(border = TRUE) +
coord_fixed(ratio = 1) +
theme(
axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")
) +
labs(
x="PC1: 14% variance",
y = "PC2: 10% variance",
title = "PCA — Liver tissue only (VST re-calculated)"
)
liver_lver
liver_lver
path
ggsave("/Users/jasge/Documents/GitHub/dsp-transcriptomics-andreas/Works/Results/03_PCAPlot_AllGenesliver.png", liver_lver, width = 8.0, height = 5.5)
ggsave("/Users/jasge/Documents/GitHub/dsp-transcriptomics-andreas/Working/Results/03_PCAPlot_AllGenesliver.png", liver_lver, width = 8.0, height = 5.5)
dds_liver
countData(dds_liver)
dds_liver@colData
count_mat <- dds_liver@colData
class(count_mat)
dds2 <- DESeqDataSetFromMatrix(countData = dds_liver@colData,
colData = samples_info,
design = ~ diet +treatment +diet:treatment)
counts_liver <- counts(dds_liver)
class(counts_liver)
dds2 <- DESeqDataSetFromMatrix(countData = counts_liver,
colData = samples_info,
design = ~ diet +treatment +diet:treatment)
samples_info_liver <- subset(samples_info, tissue == "Liver")
dds2 <- DESeqDataSetFromMatrix(countData = counts_liver,
colData = samples_info_liver,
design = ~ diet +treatment +diet:treatment)
samples_info_liver$diet <- factor(samples_info_liver$diet, levels = c("LFD", "FFMD"))
samples_info_liver$treatment <- factor(samples_info_liver$treatment, levels = c("control", "treatment"))
dds2 <- DESeqDataSetFromMatrix(
countData = counts_liver,
colData   = samples_info_liver,
design    = ~ diet * treatment
)
View(samples_info_liver)
samples_info_liver$group
unique(samples_info_liver$group)
a <- plotPCA(vsd,
intgroup = c('sample_name', 'group','tissue', 'treatment'),
returnData = TRUE)
# By condition
teste <- plotPCA(vsd, "tissue", "treatment", "group")
a <- plotPCA(vsd,
intgroup = c('sample_name', 'group','tissue', 'treatment'),
returnData = TRUE)
teste <- plotPCA(vsd, "tissue", "treatment", "group")
teste <- plotPCA(vsd, "tissue", "group")
teste$labels
ggplot(a, aes(x = PC1,
y = PC2,
color = group, #treatment
shape = tissue))
ggplot(a, aes(x = PC1,
y = PC2,
color = group, #treatment
shape = tissue)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
theme_pubr(border = TRUE) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 70% variance", y = "PC2: 12% variance", element_text(face = "bold"))
teste_liver <- plotPCA(
vsd_liver_top,
intgroup = c('sample_name', 'grou','treatment', 'diet', 'replicate'),
ntop = 28000
)
teste_liver <- plotPCA(
vsd_liver_top,
intgroup = c('sample_name', 'group','treatment', 'diet', 'replicate'),
ntop = 28000
)
teste_liver$labels
a_liver <- plotPCA(
vsd_liver_top,
intgroup = c('sample_name', 'group','treatment', 'diet', 'replicate'),
ntop = 28000,          # use top 2000 variable genes
returnData = TRUE
)
ggplot(a_liver, aes(x = PC1,
y = PC2,
color = group, #treatment
shape = diet)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values=c(15,17,19)) +
theme_pubr(border = TRUE) +
coord_fixed(ratio = 1) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 14% variance", y = "PC2: 10% variance", element_text(face = "bold"))
#group
# Make sure sample info rownames match your count matrix
rownames(samples_info_liver) <- samples_info_liver$sample_name
# Subset counts
counts_liver <- counts_liver[, rownames(samples_info_liver)]
# Convert 'group' to a factor and set a reference level
samples_info_liver$group <- factor(samples_info_liver$group)
samples_info_liver$group <- relevel(samples_info_liver$group, ref = "LI_LFD_ctrl")
# Build DESeq dataset
dds2 <- DESeqDataSetFromMatrix(
countData = counts_liver,
colData   = samples_info_liver,
design    = ~ group
)
# Run DESeq2
dds2 <- DESeq(dds2)
resultsNames(dds2)
# FFMD control vs LFD control
res_diet_effect <- results(dds2, name = "group_LI_FFMD_ctrl_vs_LI_LFD_ctrl")
# FFMD treatment vs LFD control
res_treatment_total <- results(dds2, name = "group_LI_FFMD_bala_vs_LI_LFD_ctrl")
# FFMD treatment vs FFMD control (treatment effect within diseased diet)
res_treatment_effect <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"))
# 1) FFMD control vs LFD control (diet effect)
res_diet <- results(dds2, name = "group_LI_FFMD_ctrl_vs_LI_LFD_ctrl")
# 2) FFMD treatment vs LFD control (overall treatment+diet effect)
res_treat_total <- results(dds2, name = "group_LI_FFMD_bala_vs_LI_LFD_ctrl")
# 3) FFMD treatment vs FFMD control (treatment effect within diseased diet)
res_treat_within <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"))
# Function to save and summarize results
save_deseq_results <- function(res, filename_prefix, alpha=0.05) {
# Order by adjusted p-value
resOrdered <- res[order(res$padj), ]
# Convert to data frame and add gene IDs
res_df <- as.data.frame(resOrdered)
res_df$gene <- rownames(res_df)
# Count significant genes
cat(filename_prefix, "significant genes (padj <", alpha, "):",
sum(res_df$padj < alpha, na.rm = TRUE), "\n")
# Save as TSV
out_file <- paste0(filename_prefix, "_DESeq2_results.tsv")
write.table(res_df, file = out_file, sep = "\t", quote = FALSE, row.names = FALSE)
return(res_df)
}
# Save all results
res_diet_df        <- save_deseq_results(res_diet, "res_LI_FFMD_ctrl_vs_LI_LFD_ctrl")
res_treat_total_df <- save_deseq_results(res_treat_total, "res_LI_FFMD_bala_vs_LI_LFD_ctrl")
res_treat_within_df<- save_deseq_results(res_treat_within, "res_LI_FFMD_bala_vs_LI_FFMD_ctrl")
res_treat_within_df
library(ggplot2)
library(ggpubr)
plot_volcano <- function(res_df, title) {
ggplot(res_df, aes(x = log2FoldChange, y = -log10(padj))) +
geom_point(aes(color = padj < 0.05), alpha = 0.7, size = 1.8) +
scale_color_manual(values = c("grey70", "#D46C4E")) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "black") +
labs(
title = title,
x = "log2(Fold Change)",
y = "-log10(adjusted p-value)",
color = "Significant (padj < 0.05)"
) +
theme_pubr(border = FALSE)
}
plot_volcano(res_diet_df, "FFMD Control vs LFD Control (Diet Effect)")
plot_volcano(res_treat_total_df, "FFMD Treatment vs LFD Control (Combined Effect)")
plot_volcano(res_treat_within_df, "FFMD Treatment vs FFMD Control (Treatment Effect)")
plot_volcano(res_diet_df, "FFMD Control vs LFD Control (Diet Effect)")
plot_volcano(res_treat_total_df, "FFMD Treatment vs LFD Control (Combined Effect)")
plot_volcano(res_treat_within_df, "FFMD Treatment vs FFMD Control (Treatment Effect)")
# List top 10 up- and down-regulated genes for each contrast
head(res_treat_within_df[order(res_treat_within_df$log2FoldChange, decreasing = TRUE), ], 10)
head(res_treat_within_df[order(res_treat_within_df$log2FoldChange, decreasing = FALSE), ], 10)
top_gene <- res_treat_within_df$gene[which.min(res_treat_within_df$padj)]
plotCounts(dds2, gene = top_gene, intgroup = "group")
summary(res_treat_within)
cat("Genes with padj < 0.05:", sum(res_treat_within$padj < 0.05, na.rm = TRUE), "\n")
keep <- rowSums(counts(dds2) >= 10) >= 3
dds2 <- dds2[keep, ]
dds2 <- DESeq(dds2)
cat("Genes kept after filtering:", sum(keep), "\n")
res <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"), alpha = 0.1)
res <- lfcShrink(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"), res = res, type = "ashr")
# Clean and order
res_df <- as.data.frame(res[order(res$padj), ])
res_df$gene <- rownames(res_df)
# Apply your custom filter
res_filtered <- subset(res_df, padj < 0.1 & abs(log2FoldChange) >= 1)
cat("Total genes passing filter (padj<0.1 & |LFC|>=1):", nrow(res_filtered), "\n")
library(ggplot2)
library(ggrepel)
library(ggpubr)
# Identify top 5 DE genes
top5 <- head(res_filtered[order(res_filtered$padj), ], 5)
ggplot(res_df, aes(x = log2FoldChange, y = -log10(padj))) +
geom_point(
aes(color = padj < 0.1 & abs(log2FoldChange) >= 1),
alpha = 0.6, size = 1.6
) +
scale_color_manual(values = c("grey70", "#D46C4E")) +
geom_text_repel(
data = top5,
aes(label = gene),
size = 3,
box.padding = 0.5,
max.overlaps = Inf,
segment.color = "grey60"
) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +
geom_hline(yintercept = -log10(0.1), linetype = "dashed", color = "black") +
labs(
title = "FFMD Treatment vs FFMD Control (Liver)",
x = "log2(Fold Change)",
y = "-log10(adjusted p-value)",
color = "Significant"
) +
theme_pubr(border = FALSE)
# How many genes have unadjusted p < 0.05?
sum(res_df$pvalue < 0.05, na.rm = TRUE)
# How many have |log2FC| >= 1 even if not significant?
sum(abs(res_df$log2FoldChange) >= 1, na.rm = TRUE)
# Top 10 genes by raw p-value
head(res_df[order(res_df$pvalue), c("gene", "log2FoldChange", "pvalue", "padj")], 10)
colData(dds2)$group
levels(colData(dds2)$group)
samples_info_liver$group
dds2 <- DESeq(dds2)
res <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"), alpha = 0.1)
summary(res)
str(colData(dds2))
res_diet <- results(dds2, contrast = c("group", "LI_FFMD_ctrl", "LI_LFD_ctrl"))         # diet effect
res_treatment <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"))  # treatment effect within FFMD
#group
# Subset sample info for tissue == "Liver"
samples_info_liver <- subset(samples_info, tissue == "Liver")
counts_liver <- counts(dds_liver
# Make sure sample info rownames match your count matrix
rownames(samples_info_liver) <- samples_info_liver$sample_name
#group
# Subset sample info for tissue == "Liver"
samples_info_liver <- subset(samples_info, tissue == "Liver")
counts_liver <- counts(dds_liver)
# Make sure sample info rownames match your count matrix
rownames(samples_info_liver) <- samples_info_liver$sample_name
# Subset counts
counts_liver <- counts_liver[, rownames(samples_info_liver)]
# Convert 'group' to a factor and set a reference level
samples_info_liver$group <- factor(samples_info_liver$group)
samples_info_liver$group <- relevel(samples_info_liver$group, ref = "LI_LFD_ctrl")
# Build DESeq dataset
dds2 <- DESeqDataSetFromMatrix(
countData = counts_liver,
colData   = samples_info_liver,
design    = ~ group
)
# Run DESeq2
dds2 <- DESeq(dds2)
resultsNames(dds2)
#[1] "Intercept"
#[2] "group_LI_FFMD_bala_vs_LI_LFD_ctrl"
#[3] "group_LI_FFMD_ctrl_vs_LI_LFD_ctrl"
# 1) FFMD control vs LFD control (diet effect)
res_diet <- results(dds2, name = "group_LI_FFMD_ctrl_vs_LI_LFD_ctrl")
# 2) FFMD treatment vs LFD control (overall treatment+diet effect)
res_treat_total <- results(dds2, name = "group_LI_FFMD_bala_vs_LI_LFD_ctrl")
# 3) FFMD treatment vs FFMD control (treatment effect within diseased diet)
res_treat_within <- results(dds2, contrast = c("group", "LI_FFMD_bala", "LI_FFMD_ctrl"))
# Function to save and summarize results
save_deseq_results <- function(res, filename_prefix, alpha=0.05) {
# Order by adjusted p-value
resOrdered <- res[order(res$padj), ]
# Convert to data frame and add gene IDs
res_df <- as.data.frame(resOrdered)
res_df$gene <- rownames(res_df)
# Count significant genes
cat(filename_prefix, "significant genes (padj <", alpha, "):",
sum(res_df$padj < alpha, na.rm = TRUE), "\n")
# Save as TSV
out_file <- paste0(filename_prefix, "_DESeq2_results.tsv")
write.table(res_df, file = out_file, sep = "\t", quote = FALSE, row.names = FALSE)
return(res_df)
}
# Save all results
res_diet_df        <- save_deseq_results(res_diet, "res_LI_FFMD_ctrl_vs_LI_LFD_ctrl")
res_treat_total_df <- save_deseq_results(res_treat_total, "res_LI_FFMD_bala_vs_LI_LFD_ctrl")
res_treat_within_df<- save_deseq_results(res_treat_within, "res_LI_FFMD_bala_vs_LI_FFMD_ctrl")
library(ggplot2)
library(ggpubr)
plot_volcano <- function(res_df, title) {
ggplot(res_df, aes(x = log2FoldChange, y = -log10(padj))) +
geom_point(aes(color = padj < 0.05), alpha = 0.7, size = 1.8) +
scale_color_manual(values = c("grey70", "#D46C4E")) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "black") +
labs(
title = title,
x = "log2(Fold Change)",
y = "-log10(adjusted p-value)",
color = "Significant (padj < 0.05)"
) +
theme_pubr(border = FALSE)
}
plot_volcano(res_diet_df, "FFMD Control vs LFD Control (Diet Effect)")
plot_volcano(res_treat_total_df, "FFMD Treatment vs LFD Control (Combined Effect)")
plot_volcano(res_treat_within_df, "FFMD Treatment vs FFMD Control (Treatment Effect)")
plot_volcano(res_diet_df, "FFMD Control vs LFD Control (Diet Effect)")
plot_volcano(res_treat_total_df, "FFMD Treatment vs LFD Control (Combined Effect)")
plot_volcano(res_treat_within_df, "FFMD Treatment vs FFMD Control (Treatment Effect)")
dds2 <- DESeqDataSetFromMatrix(
countData = counts_liver,
colData   = samples_info_liver,
design    = ~ treatment
)
# Run DESeq2
dds2 <- DESeq(dds2)
resultsNames(dds2)
#[1] "Intercept"
#[2] "group_LI_FFMD_bala_vs_LI_LFD_ctrl"
#[3] "group_LI_FFMD_ctrl_vs_LI_LFD_ctrl"
treatment_treatment_vs_control <- results(dds2, name = "treatment_treatment_vs_control")
yaml::yaml.load_file("yourfile.Rmd")
yaml::yaml.load_file("Data_Visualization.Rmd")
getwd()
yaml::yaml.load_file("/Users/jasge/Documents/GitHub/dsp_workshop_datavizR/01_intro.Rmd")
getwd()
getwd()
readr::read_lines("01_intro.Rmd") |>
stringi::stri_enc_toutf8() |>
grep("\t|\\u00a0", ., value = TRUE)
setwd("/Users/jasge/Documents/GitHub/dsp_workshop_datavizR/")
getwd()
yaml::yaml.load_file("01_intro.Rmd")
