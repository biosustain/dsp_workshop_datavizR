# Introduction


`ggplot2` is an R package for producing visualizations of data. `ggplot2` uses a conceptual framework based on the grammar of graphics.
More complete information about how to use `ggplot2` can be found in the [book](https://ggplot2-book.org).

For structure, we go over the **7 composable parts** that come together as a set of instructions on how to draw a chart.


`gplot2` needs at least the following three to produce a chart: **data, a mapping, and a layer**. The `scales`, `facets`, `coordinates`, and `themes` have sensible defaults that take away a lot of finicky work.


## Data

As the foundation of every graphic, `ggplot2` uses data to construct a plot. The system works best if the data is provided in a `tidy` format (we're going to explorer it in the next section), which briefly means a rectangular data frame structure where rows are observations and columns are variables.

As the first step in many plots, you would pass the data to the `ggplot()` function, which stores the data to be used later by other parts of the plotting system. For example, if we intend to make a graphic about the mpg dataset, we would start as follows:

<div class="remember">
  <strong>üìå Remember:</strong> Load the library before starting the analysis.
</div>

```{r}
library(ggplot2)
data(package = "ggplot2")
mpg
```


<div class="tip">
  <strong>üí° Tip:</strong> You can use the command `View` to visualize the data. Try it yourself.
</div>


<div class="advanced">
  <strong>üß† Advanced:</strong> [DT](https://rstudio.github.io/DT/) package is an excellent option to explore the metadata! Try it yourself.
</div>


```{r, eval=FALSE}
library(DT)

#Simple
datatable(head(mpg), class = 'cell-border stripe')


#Complex
DT::datatable(data = mpg, rownames = FALSE, 
              extensions = c('Buttons', 'Scroller'), 
              options = list(dom = 'Bfrtip', buttons = c('copy', 'csv'),
                             deferRender = TRUE, scrollX = T,
                             scrollX = T,
                             scrollY = 200,
                             scroller = TRUE,
                             caption = 'mpg metadata'))
```

`mpg` includes information about the fuel economy of popular car models in 1999 and 2008, collected by the [US Environmental Protection Agency](http://fueleconomy.gov) 

The variables are mostly self-explanatory:

<code class="var-blue">cty</code> and <code class="var-blue">hwy</code> record miles per gallon (mpg) for city and highway driving.  

<code class="var-orange">displ</code> is the engine displacement in litres.  

<code class="var-blue">drv</code> is the drivetrain: front wheel (f), rear wheel (r) or four wheel (4).  

<code class="var-blue">model</code> is the model of car. There are 38 models, selected because they had a new edition every year between 1999 and 2008.  

<code class="var-orange">class</code> is a categorical variable describing the ‚Äútype‚Äù of car: two seater, SUV, compact, etc.


This dataset suggests many interesting questions. 

How are engine size and fuel economy related? Do certain manufacturers care more about fuel economy than others? Has fuel economy improved in the last ten years? We will try to answer some of these questions, and in the process learn how to create some basic plots with ggplot2.



### Understanding the grammar of the plots

<code data="var-orange">data</code>

```{r}
ggplot(data = mpg)
```


<div class="question">
  <strong>‚ùì Question:</strong> Why is it empty?
</div>

### Mapping

The mapping of a plot is a set of instructions on how parts of the data are mapped onto aesthetic attributes of geometric objects. It is the ‚Äòdictionary‚Äô to translate tidy data to the graphics system.

A mapping can be made by using the <code data="var-orange">aes()</code>  function to make pairs of graphical attributes and parts of the data. If we want the cty and hwy columns to map to the x- and y-coordinates in the plot, we can do that as follows:



```{r}
ggplot(mpg, mapping = aes(x = cty, y = hwy))
```



### Layers


The heart of any graphic is the layers. They take the mapped data and display it in something humans can understand as a representation of the data. Every layer consists of three important parts:


The geometry that determines how data are displayed, such as points, lines, or rectangles.
The statistical transformation that may compute new variables from the data and affect what of the data is displayed.
The position adjustment that primarily determines where a piece of data is being displayed.
A layer can be constructed using the geom_*() and stat_*() functions. These functions often determine one of the three parts of a layer, while the other two can still be specified. Here is how we can use two layers to display the cty and hwy columns of the mpg dataset as points and stack a trend line on top.


```{r}
ggplot(mpg, aes(cty, hwy)) +
  # to create a scatterplot
  geom_point() +
  # to fit and overlay a loess trendline
  geom_smooth(formula = y ~ x, method = "lm")
```

