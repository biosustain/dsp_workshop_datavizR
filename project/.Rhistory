base_mean <- rpois(ngenes, lambda = 50)
# strong condition effect
condition_effect <- rnorm(ngenes, mean = 0, sd = 10)
condition_effect[1:200] <- condition_effect[1:200] + 100  # strong separation
# age effect (milder)
age_effect <- rnorm(ngenes, mean = 0, sd = 5)
age_effect[1:200] <- age_effect[1:200] + 30
# build counts
counts <- sapply(1:8, function(i){
x <- base_mean
# Condition
if(sample_info$Condition[i] == "cae5H"){
x <- x + condition_effect
}
# Age
if(sample_info$Age[i] == "aged"){
x <- x + age_effect
}
# Variability per sample
x <- x + rpois(ngenes, lambda = 20)
# No negative values
x[x<1] <- 1
return(round(x))
})
colnames(counts) <- sample_info$Sample
rownames(counts) <- paste0("Gene", 1:ngenes)
########################################
### 3. DESeq2 object and VST
########################################
dds <- DESeqDataSetFromMatrix(
countData = counts,
colData = sample_info,
design = ~ Condition + Age
)
vsd <- vst(dds)
cols_condition <- c("Control" = "#264D59", "cae5H" = "#8B4513")
cols_aged <- c("young" = "#003366", "aged" = "#B70404")
topVarGenes_p <- head(order(rowVars(assay(vsd)), decreasing = TRUE), 500)
a <- plotPCA(vsd, intgroup = c('Sample','Condition','Age'), returnData = TRUE)
# By condition
teste <- plotPCA(vsd, "Age", "Condition")
teste$labels
PCAPlot <- ggplot(a, aes(x = PC1, y = PC2, color = Age, shape = Condition)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values = c(15,17,19)) +
theme_pubr(border = TRUE) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 75% variance", y = "PC2: 7% variance", element_text(face = "bold")) +
scale_color_manual(values = cols_aged)
PCAPlot
PCAPlot
library(DESeq2)
library(matrixStats)
library(ggplot2)
library(ggpubr)
set.seed(123)
##############################
### 1. Sample metadata
##############################
sample_info <- data.frame(
Sample = paste0("S", 1:8),
Condition = rep(c("Control", "treatment"), each = 4),
Age = rep(c("young", "aged"), times = 4)
)
rownames(sample_info) <- sample_info$Sample
sample_info
######################################
### 2. Simulate count matrix
######################################
ngenes <- 1000
# baseline expression
base_mean <- rpois(ngenes, lambda = 50)
# strong condition effect
condition_effect <- rnorm(ngenes, mean = 0, sd = 10)
condition_effect[1:200] <- condition_effect[1:200] + 100  # strong separation
# age effect (milder)
age_effect <- rnorm(ngenes, mean = 0, sd = 5)
age_effect[1:200] <- age_effect[1:200] + 30
# build counts
counts <- sapply(1:8, function(i){
x <- base_mean
# Condition
if(sample_info$Condition[i] == "treatment"){
x <- x + condition_effect
}
# Age
if(sample_info$Age[i] == "aged"){
x <- x + age_effect
}
# Variability per sample
x <- x + rpois(ngenes, lambda = 20)
# No negative values
x[x<1] <- 1
return(round(x))
})
colnames(counts) <- sample_info$Sample
rownames(counts) <- paste0("Gene", 1:ngenes)
########################################
### 3. DESeq2 object and VST
########################################
dds <- DESeqDataSetFromMatrix(
countData = counts,
colData = sample_info,
design = ~ Condition + Age
)
vsd <- vst(dds)
cols_condition <- c("Control" = "#264D59", "treatment" = "#8B4513")
cols_aged <- c("young" = "#003366", "aged" = "#B70404")
topVarGenes_p <- head(order(rowVars(assay(vsd)), decreasing = TRUE), 500)
a <- plotPCA(vsd, intgroup = c('Sample','Condition','Age'), returnData = TRUE)
# By condition
teste <- plotPCA(vsd, "Age", "Condition")
teste$labels
PCAPlot <- ggplot(a, aes(x = PC1, y = PC2, color = Age, shape = Condition)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values = c(15,17,19)) +
theme_pubr(border = TRUE) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 75% variance", y = "PC2: 7% variance", element_text(face = "bold")) +
scale_color_manual(values = cols_aged)
PCAPlot
PCAPlot
teste$labels
library(DESeq2)
library(matrixStats)
library(ggplot2)
library(ggpubr)
set.seed(123)
##############################
### 1. Sample metadata
##############################
sample_info <- data.frame(
Sample = paste0("S", 1:8),
Condition = rep(c("Control", "Treatment"), each = 4),
Age = rep(c("young", "aged"), times = 4)
)
rownames(sample_info) <- sample_info$Sample
sample_info
######################################
### 2. Simulate count matrix
######################################
ngenes <- 1000
# baseline expression
base_mean <- rpois(ngenes, lambda = 50)
# strong condition effect
condition_effect <- rnorm(ngenes, mean = 0, sd = 10)
condition_effect[1:200] <- condition_effect[1:200] + 100  # strong separation
# age effect (milder)
age_effect <- rnorm(ngenes, mean = 0, sd = 5)
age_effect[1:200] <- age_effect[1:200] + 30
# build counts
counts <- sapply(1:8, function(i){
x <- base_mean
# Condition
if(sample_info$Condition[i] == "Treatment"){
x <- x + condition_effect
}
# Age
if(sample_info$Age[i] == "aged"){
x <- x + age_effect
}
# Variability per sample
x <- x + rpois(ngenes, lambda = 20)
# No negative values
x[x<1] <- 1
return(round(x))
})
colnames(counts) <- sample_info$Sample
rownames(counts) <- paste0("Gene", 1:ngenes)
########################################
### 3. DESeq2 object and VST
########################################
dds <- DESeqDataSetFromMatrix(
countData = counts,
colData = sample_info,
design = ~ Condition + Age
)
vsd <- vst(dds)
cols_condition <- c("Control" = "#264D59", "Treatment" = "#8B4513")
cols_aged <- c("young" = "#003366", "aged" = "#B70404")
topVarGenes_p <- head(order(rowVars(assay(vsd)), decreasing = TRUE), 500)
a <- plotPCA(vsd, intgroup = c('Sample','Condition','Age'), returnData = TRUE)
# By condition
teste <- plotPCA(vsd, "Age", "Condition")
teste$labels
PCAPlot <- ggplot(a, aes(x = PC1, y = PC2, color = Age, shape = Condition)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values = c(15,17,19)) +
theme_pubr(border = TRUE) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 75% variance", y = "PC2: 7% variance", element_text(face = "bold")) +
scale_color_manual(values = cols_aged)
PCAPlot
PCAPlot
PCAPlot <- ggplot(a, aes(x = PC1, y = PC2, color = Condition, shape = Age)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = 'dashed', alpha = 0.3) +
geom_vline(xintercept = 0, linetype = 'dashed', alpha = 0.3) +
scale_shape_manual(values = c(15,17,19)) +
theme_pubr(border = TRUE) +
theme(axis.text=element_text(size=14),
axis.text.x = element_text(size = 12, hjust = 0.5),
axis.title.y = element_text(size = 18),
legend.text=element_text(size=14),
legend.title=element_text(size=0),
legend.position="bottom",
axis.title.x = element_text(size = 18),
strip.text.x = element_text(size = 20, face = "bold")) +
labs(x="PC1: 75% variance", y = "PC2: 7% variance", element_text(face = "bold")) +
scale_color_manual(values = cols_condition)
PCAPlot
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
rmarkdown::render("DataVizR_Workshop.Rmd")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
knitr::include_url("https://docs.google.com/presentation/d/1ifS-JNsKchnT3tlZtZsDes7oRqoKTbjO/embed")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
mpg_plotly <- ggplot(mpg, aes(displ, hwy)) +
geom_point()
ggplotly(mpg_plotly)
plot_ly(
data = mpg,
x = ~displ,
y = ~hwy,
type = 'scatter',
mode = 'markers'
)
library(ggplot2)
ggplot(mpg, aes(x = displ,
y = hwy,
colour = class,     # categorical
size = displ)) +    # continuous
geom_point(alpha = 0.8) +
scale_size_continuous(range = c(2, 8)) +
labs(
title = "Engine Size vs Highway Efficiency",
subtitle = "Colour = vehicle class (categorical), Size = engine displacement (continuous)",
x = "Engine displacement (L)",
y = "Highway MPG",
colour = "Vehicle Class",
size = "Displ"
) +
theme_pubr(border = FALSE)
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
library(ggplot2)
# Original plot â€“ points overlap
ggplot(mpg, aes(cty, hwy)) +
geom_point() +
labs(title = "City vs Highway MPG (overlapping points)")
# Option 1: jitter points slightly
ggplot(mpg, aes(cty, hwy)) +
geom_jitter(width = 0.2, height = 0.2) +
labs(title = "City vs Highway MPG (jittered)")
# Option 2: size points by count
ggplot(mpg, aes(cty, hwy)) +
geom_count() +
labs(title = "City vs Highway MPG (point size = count)")
ggplot(mpg, aes(cty, hwy)) +
geom_jitter(width = 0.2, height = 0.2) +
labs(title = "City vs Highway MPG (jittered)")
ggplot(mpg, aes(class, hwy)) +
geom_boxplot() +
labs(title = "Highway MPG by Vehicle Class (alphabetical order)")
# Reorder class by median highway MPG
ggplot(mpg, aes(reorder(class, hwy, FUN = median), hwy)) +
geom_boxplot() +
labs(
x = "Vehicle Class (ordered by median hwy MPG)",
title = "Highway MPG by Vehicle Class (reordered)"
)
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
ggplot(mpg, aes(displ, hwy, colour = class, size = cyl, shape = drv)) +
geom_point()
ggplot(mpg, aes(displ, hwy, shape = displ)) +
geom_point()
ggplot(mpg, aes(displ, hwy, shape = displ)) +
geom_point()
ggplot(mpg, aes(displ, hwy, shape = displ)) +
geom_point()
ggplot(mpg, aes(displ, hwy, shape = trans)) +
geom_point()
ggplot(mpg) +
geom_point(aes(mpg$displ, mpg$hwy))
ggplot() +
geom_point(mapping = aes(y = hwy, x = cty), data = mpg) +
geom_smooth(data = mpg, mapping = aes(cty, hwy))
ggplot(diamonds, aes(carat, price)) +
geom_point(aes(log(brainwt), log(bodywt)), data = msleep)
ggplot(mpg) +
geom_point(aes(class, cty)) +
geom_boxplot(aes(trans, hwy))
dplot <- ggplot(diamonds, aes(color, fill = cut)) +
xlab(NULL) + ylab(NULL) + theme(legend.position = "none")
# position stack is the default for bars, so `geom_bar()`
# is equivalent to `geom_bar(position = "stack")`.
dplot + geom_bar()
dplot + geom_bar(position = "fill")
dplot + geom_bar(position = "dodge")
# Example
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
facet_wrap(~hwy)
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
facet_wrap(~cyl)
facet_wrap(~cyl, nrow = 1, ncol = 3)
facet_wrap(~cyl, scales = "free")
ggplot(mpg, aes(hwy)) + geom_bar()
ggplot(mpg, aes(hwy)) + geom_density()
dplot <- ggplot(diamonds, aes(color, fill = cut)) +
xlab(NULL) + ylab(NULL) + theme(legend.position = "none")
# position stack is the default for bars, so `geom_bar()`
# is equivalent to `geom_bar(position = "stack")`.
dplot + geom_bar()
dplot <- ggplot(mpg, aes(color, fill = cyt)) +
xlab(NULL) + ylab(NULL) + theme(legend.position = "none")
# position stack is the default for bars, so `geom_bar()`
# is equivalent to `geom_bar(position = "stack")`.
dplot + geom_bar()
dplot <- ggplot(mpg, aes(color, fill = drv)) +
dplot + geom_bar()
dplot <- ggplot(mpg, aes(color, fill = hwy)) +
dplot + geom_bar()
dplot <- ggplot(mpg, aes(color, fill = drv)) +
xlab(NULL) + ylab(NULL) + theme(legend.position = "none") + dplot + geom_bar()
dplot <- ggplot(mpg, aes(color, fill = drv))
dplot <- ggplot(mpg, aes(color, fill = drv)) ggplot(mpg, aes(displ, hwy)) +
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
geom_smooth(aes(colour = "loess"), method = "loess", se = FALSE) +
geom_smooth(aes(colour = "lm"), method = "lm", se = FALSE) +
labs(colour = "Method")
#> `geom_smooth()` using formula = 'y ~ x'
#> `geom_smooth()` using formula = 'y ~ x'
ggplot(mpg) +
geom_point(aes(class, cty)) +
geom_boxplot(aes(trans, hwy))
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bestfit <- geom_smooth(
method = "lm",
se = FALSE,
colour = alpha("steelblue", 0.5),
linewidth = 2
)
ggplot(mpg, aes(cty, hwy)) +
geom_point() +
bestfit
#> `geom_smooth()` using formula = 'y ~ x'
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
bestfit
#> `geom_smooth()` using formula = 'y ~ x'
geom_lm <- function(formula = y ~ x, colour = alpha("steelblue", 0.5),
linewidth = 2, ...)  {
geom_smooth(formula = formula, se = FALSE, method = "lm", colour = colour,
linewidth = linewidth, ...)
}
ggplot(mpg, aes(displ, 1 / hwy)) +
geom_point() +
geom_lm()
ggplot(mpg, aes(displ, 1 / hwy)) +
geom_point() +
geom_lm(y ~ poly(x, 2), linewidth = 1, colour = "red")
geom_mean <- function() {
list(
stat_summary(fun = "mean", geom = "bar", fill = "grey70"),
stat_summary(fun.data = "mean_cl_normal", geom = "errorbar", width = 0.4)
)
}
ggplot(mpg, aes(class, cty)) + geom_mean()
ggplot(mpg, aes(drv, cty)) + geom_mean()
plots <- list(
ggplot(mpg, aes(displ, hwy)),
ggplot(diamonds, aes(carat, price)),
ggplot(faithfuld, aes(waiting, eruptions, size = density))
)
View(mpg)
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
labs(
title = "Engine Size vs Highway Fuel Efficiency",
x = "Engine Displacement (litres)",
y = "Highway MPG",
caption = "mpg dataset, ggplot"
)
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
labs(
title = "Engine Size vs Highway Fuel Efficiency",
x = "Engine Displacement (litres)",
y = "Highway (mpg)",
caption = "mpg dataset, ggplot"
)
ggplot(mpg, aes(displ, hwy)) +
geom_point() +
labs(
title = "Engine Size vs Highway Fuel Efficiency",
x = "Engine Displacement (litres)",
y = "Highway (mpg)",
caption = "mpg dataset, ggplot"
)
ggplot(mpg, aes(displ, hwy)) +
geom_point()
ggplot(mpg, aes(displ, hwy)) +
geom_point(aes(color = class)) +
labs(
title = "Engine Size vs Highway Fuel Efficiency",
subtitle = "Colored by vehicle class",
x = "Engine Displacement (litres)",
y = "Highway (mpg)",
color = "Vehicle Class",
caption = "mpg dataset, ggplot"
)
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
knitr::include_graphics('../data-01/figures/labs.png')
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
View(protein_data_parsed)
protein_data_parsed <- readRDS("../data-01/protein_data_parsed_mut.rds")
View(protein_data_parsed)
data <- read_csv("../data-01/PXD040621_peptides.csv", show_col_types = FALSE)
library(readr)
library(plotly)
library(tidyverse)
data <- read_csv("../data-01/PXD040621_peptides.csv", show_col_types = FALSE)
View(data)
DT::datatable(
data = head(protein_data_parsed, 1000),  # show only the first 1000 rows
rownames = FALSE,
extensions = c('Buttons', 'Scroller'),
options = list(
dom = 'Bfrtip',
buttons = c('copy', 'csv'),
deferRender = TRUE,
scrollX = TRUE,
scrollY = 200,
scroller = TRUE
),
caption = 'proteomics metadata'
)
View(data)
data <- data %>%
mutate(Intensity = log2(Intensity))
View(data)
data <- read_csv("../data-01/PXD040621_peptides.csv", show_col_types = FALSE)
head(data$Intensity)
data <- data %>%
mutate(Intensity = log2(Intensity))
head(data$Intensity)
options(error = traceback)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
